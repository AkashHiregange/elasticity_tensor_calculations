def generate_deformed_strutures(atoms_object, path=None, norm_strains = [0.01, 0.03], shear_strains = [0.01, 0.03], write_strain=True):
    """
    Generate a set of deformed atomic structures by applying normal and shear
    strain to the input structure.

    Parameters
    ----------
    atoms_object : ase.Atoms
        The undeformed equilibrium atomic structure from which strained configurations
        will be generated.
    path: str, optional
        Path pointing towards the directory that will be the working directory for this workflow.
        In this function, the path will be used to write the strain tensor as a .pkl file.
        If None, the current working directory will be used.
    norm_strains : list of float, optional
        A list of normal strain magnitudes to apply along the principal
        directions. Each value produces 3 separate deformed structures. For example [0.01] produces three different
        strain tensor [[0.01,0,0],[0,0,0],[0,0,0]], [[0,0,0],[0,0.01,0],[0,0,0]], [[0,0,0],[0,0,0],[0,0,0.01]]
        Default is [0.01, 0.03] --> therefore 6 deformed structures due to norm strain.
    shear_strains : list of float, optional
        A list of shear strain magnitudes to apply to the off-diagonal
        components of the strain tensor. Each value produces 3 additional deformed structures.
        Default is [0.01, 0.03] --> therefore 6 additional deformed structures due to shear strain.
    write_strain : bool, optional
        If True (default), write the strain tensor to a pickle file. The default file name is strain_tensor.pkl.

    Returns
    -------
    equilibrium structure: Pymatgen.Structure
    deformed_structures : list of ase.Atoms
        A list containing all deformed `Atoms` objects generated from the
        input structure. The list includes both normal and shear strain
        deformations.

    Notes
    -----
    - Normal strains correspond to scaling of lattice vectors and atomic
      positions along x, y, and z directions.
    - Shear strains modify lattice angles and introduce off-diagonal
      distortions.
    """
    import pickle
    import numpy as np
    from pymatgen.analysis.elasticity import Strain, Deformation
    from pymatgen.io.ase import AseAtomsAdaptor

    eq_structure = atoms_object
    structure = AseAtomsAdaptor.get_structure(eq_structure)

    deformations: list[Deformation] = []

    strain_list = []
    for ind in [(0, 0), (1, 1), (2, 2)]:
        for amount in norm_strains:
            strain = Strain.from_index_amount(ind, amount)
            strain_list.append(strain)
            deformations.append(strain.get_deformation_matrix())
    for ind in [(0, 1), (0, 2), (1, 2)]:
        for amount in shear_strains:
            strain = Strain.from_index_amount(ind, amount)
            strain_list.append(strain)
            deformations.append(strain.get_deformation_matrix())

    if write_strain:
        strain_tensor = np.array(strain_list)
        if path is None:
            with open('strain_tensor.pkl', 'wb') as fp:
                pickle.dump(strain_tensor, fp)
        else:
            with open(f'{path}/strain_tensor.pkl', 'wb') as fp:
                pickle.dump(strain_tensor, fp)

    return structure, deformations

def create_files_and_directories(structure, deformations, path=None, file_format='.in', copy_input_and_submission=False):
    """
    Create directory for each deformed configuration and write the
    corresponding structural files. Optionally copy additional input and
    submission scripts into each directory.

    Parameters
    ----------
    structure : pymatgen.Structure
        The equilibrium structure from which each deformed configuration
        is derived. Used as the base structure for file writing.
    deformations : list of deformations generated by generate_deformed_structures() function.
        A list of deformed structures (e.g., generated from strain or
        displacement operations). Each element corresponds to one output
        directory.
    path: str, optional
        Path pointing towards the directory that will be working directory for this workflow.
        Make sure that this path is used in the read_stress_from_output() function of calculate_elasticity_tensor.py
        during the post-processing of results.
        The function will create the following structure in the path specified
        ---> defor_1
        ---> defor_2
        ...
        ---> defor_n
        where defor_1, defor_2,... contains the deformed structures for first-principles/force-field calculations
        structures.
        If None, the current working directory will be used.
    file_format: str, optional
    format of the saved deformed geometry file in each directory.
        Default is .in format.
    copy_input_and_submission : bool, optional
        If True, copy the input.py files and batch submission scripts
        into every generated directory. Default is False. If setting to True, make sure the path you provide using 'path'
        argument contains an input.py and submission.script file

    Returns
    -------
    None
        This function writes files to disk and organizes them into
        directories but does not return any value.

    Notes
    -----
    - Directories are typically named using a systematic pattern such as
      ``defor_1``, ``defor_2``, etc.
    - Each directory contains the structural file for the corresponding
      deformation, commonly written in formats such as ``.xyz``, ``.traj``,
      or FHI-aims ``geometry.in`` format. This depends on the parameter file_format
    - When `copy_input_and_submission=True`, ensure the required input.py and submission.script
      files exist in the working directory before calling this function.
    """
    import os
    import shutil
    from pymatgen.io.ase import AseAtomsAdaptor
    deformed_struct = [defo.apply_to_structure(structure) for defo in deformations]

    if path is None:
        home = os.getcwd()
    else:
        home = path

    for i, def_struc in enumerate(deformed_struct):
        dir_no = i + 1
        directory = f'defor_{dir_no}'
        path_final = os.path.join(home, directory)
        if os.path.exists(path_final):
            shutil.rmtree(path_final)
        os.mkdir(path_final)
        atoms = AseAtomsAdaptor.get_atoms(def_struc)
        atoms.write(path_final + f'/geometry{file_format}')
        if copy_input_and_submission:
            shutil.copy(home + '/input.py', path_final + '/input.py')
            shutil.copy(home + '/submission.script', path_final + '/submission.script')





